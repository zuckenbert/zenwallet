# ZenWallet MVP 1.1.0 - Core Wallet Features

> Implementation plan for core wallet functionality: Balance, Send, Receive, Swap

**Reference Document:** `/Users/lucasbertol/zenwallet/MASTERPLAN.md`
**Previous Plan:** `/Users/lucasbertol/zenwallet/docs/plans/2025-12-26-zenwallet-implementation.md`

---

## Metadata

| Campo | Valor |
|-------|-------|
| **Projeto** | ZenWallet - Crypto Wallet Gamificada |
| **Versao** | MVP 1.1.0 |
| **Stack** | React 19 + TypeScript + Tailwind + Solana + Framer Motion |
| **Data** | 2025-12-26 |
| **Prerequisito** | MVP 1.0.0 completo (onboarding, gamification engine) |

---

## Architecture Overview

```
MVP 1.1.0 New Files:
├── src/
│   ├── lib/
│   │   ├── solana/
│   │   │   ├── tokens.ts         # [NEW] SPL token helpers
│   │   │   └── transactions.ts   # [NEW] Transaction builders
│   │   └── jupiter/
│   │       └── client.ts         # [NEW] Jupiter API integration
│   ├── hooks/
│   │   ├── useBalance.ts         # [NEW] Balance fetching
│   │   ├── useTransaction.ts     # [NEW] Send transaction
│   │   └── useSwap.ts            # [NEW] Jupiter swap
│   ├── components/
│   │   └── wallet/
│   │       ├── BalanceCard.tsx   # [NEW] Main balance display
│   │       ├── TokenList.tsx     # [NEW] Token portfolio
│   │       ├── SendModal.tsx     # [NEW] Send transaction
│   │       ├── ReceiveModal.tsx  # [NEW] QR code receive
│   │       └── SwapInterface.tsx # [NEW] Jupiter swap UI
│   ├── pages/
│   │   ├── Home.tsx              # [UPDATE] Full implementation
│   │   ├── Assets.tsx            # [UPDATE] Full implementation
│   │   ├── Swap.tsx              # [UPDATE] Full implementation
│   │   ├── Achievements.tsx      # [UPDATE] Full implementation
│   │   └── Settings.tsx          # [UPDATE] Enhanced
│   ├── types/
│   │   └── token.ts              # [NEW] Token types
│   └── constants/
│       └── tokens.ts             # [NEW] Known token metadata
```

---

## Sprint Overview

| Batch | Focus | Tasks | Est. Time |
|-------|-------|-------|-----------|
| 4.1 | Token Types & Constants | 2 tasks | ~10 min |
| 4.2 | Solana Token Library | 2 tasks | ~15 min |
| 4.3 | Balance Hook & Components | 3 tasks | ~20 min |
| 4.4 | Send Transaction | 3 tasks | ~25 min |
| 4.5 | Receive Modal | 1 task | ~10 min |
| 4.6 | Jupiter Swap | 4 tasks | ~35 min |
| 4.7 | Page Implementations | 5 tasks | ~30 min |
| 4.8 | Auth Guard & Polish | 2 tasks | ~15 min |

---

## Batch 4.1: Token Types & Constants

### Task 4.1.1: Create Token Types

**File:** `src/types/token.ts`

**Code:**
```typescript
export interface TokenBalance {
  mint: string;
  symbol: string;
  name: string;
  decimals: number;
  balance: number;        // Raw balance
  uiBalance: number;      // Human readable balance
  usdValue: number | null;
  logoURI?: string;
  isNative?: boolean;
}

export interface TokenPrice {
  mint: string;
  priceUsd: number;
  change24h?: number;
}

export interface SwapQuote {
  inputMint: string;
  outputMint: string;
  inputAmount: number;
  outputAmount: number;
  priceImpact: number;
  fee: number;
  route: string[];
}

export interface TransactionResult {
  signature: string;
  status: 'success' | 'failed';
  error?: string;
}
```

**Verification:**
```bash
cd /Users/lucasbertol/zenwallet && npm run build
# Should compile without errors
```

---

### Task 4.1.2: Create Token Constants

**File:** `src/constants/tokens.ts`

**Code:**
```typescript
export interface TokenMetadata {
  mint: string;
  symbol: string;
  name: string;
  decimals: number;
  logoURI: string;
}

// Native SOL (wrapped address for consistency)
export const SOL_MINT = 'So11111111111111111111111111111111111111112';

// Popular tokens on Solana
export const KNOWN_TOKENS: Record<string, TokenMetadata> = {
  [SOL_MINT]: {
    mint: SOL_MINT,
    symbol: 'SOL',
    name: 'Solana',
    decimals: 9,
    logoURI: 'https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png',
  },
  'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v': {
    mint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
    symbol: 'USDC',
    name: 'USD Coin',
    decimals: 6,
    logoURI: 'https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png',
  },
  'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB': {
    mint: 'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB',
    symbol: 'USDT',
    name: 'Tether USD',
    decimals: 6,
    logoURI: 'https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB/logo.svg',
  },
  'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263': {
    mint: 'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263',
    symbol: 'BONK',
    name: 'Bonk',
    decimals: 5,
    logoURI: 'https://arweave.net/hQiPZOsRZXGXBJd_82PhVdlM_hACsT_q6wqwf5cSY7I',
  },
};

export function getTokenMetadata(mint: string): TokenMetadata | null {
  return KNOWN_TOKENS[mint] || null;
}

// Fee configuration
export const ZENWALLET_FEE_BPS = 50; // 0.5%
```

**Verification:**
```typescript
// In browser console:
import { KNOWN_TOKENS, SOL_MINT } from '@/constants/tokens';
console.log(KNOWN_TOKENS[SOL_MINT]); // Should show SOL metadata
```

---

## Batch 4.2: Solana Token Library

### Task 4.2.1: Create Token Helpers

**File:** `src/lib/solana/tokens.ts`

**Code:**
```typescript
import { Connection, PublicKey, LAMPORTS_PER_SOL } from '@solana/web3.js';
import { getConnection } from './connection';
import { TokenBalance } from '@/types/token';
import { KNOWN_TOKENS, SOL_MINT, getTokenMetadata } from '@/constants/tokens';

const HELIUS_API_KEY = import.meta.env.VITE_HELIUS_API_KEY || '';

interface HeliusAsset {
  id: string;
  interface: string;
  content: {
    metadata: {
      name: string;
      symbol: string;
    };
    links?: {
      image?: string;
    };
  };
  token_info?: {
    balance: number;
    decimals: number;
    price_info?: {
      price_per_token: number;
    };
  };
}

export async function fetchBalances(publicKey: string): Promise<TokenBalance[]> {
  const connection = getConnection();
  const balances: TokenBalance[] = [];

  // 1. Get native SOL balance
  try {
    const lamports = await connection.getBalance(new PublicKey(publicKey));
    const solBalance = lamports / LAMPORTS_PER_SOL;

    balances.push({
      mint: SOL_MINT,
      symbol: 'SOL',
      name: 'Solana',
      decimals: 9,
      balance: lamports,
      uiBalance: solBalance,
      usdValue: null, // Will be fetched separately
      logoURI: KNOWN_TOKENS[SOL_MINT]?.logoURI,
      isNative: true,
    });
  } catch (error) {
    console.error('Error fetching SOL balance:', error);
  }

  // 2. Get SPL tokens via Helius DAS API (if available)
  if (HELIUS_API_KEY) {
    try {
      const response = await fetch(
        `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            jsonrpc: '2.0',
            id: 'zenwallet',
            method: 'searchAssets',
            params: {
              ownerAddress: publicKey,
              tokenType: 'fungible',
              displayOptions: {
                showNativeBalance: false,
              },
            },
          }),
        }
      );

      const data = await response.json();
      const assets: HeliusAsset[] = data?.result?.items || [];

      for (const asset of assets) {
        if (!asset.token_info || asset.token_info.balance === 0) continue;

        const knownToken = getTokenMetadata(asset.id);
        const uiBalance = asset.token_info.balance / Math.pow(10, asset.token_info.decimals);

        balances.push({
          mint: asset.id,
          symbol: knownToken?.symbol || asset.content?.metadata?.symbol || 'UNKNOWN',
          name: knownToken?.name || asset.content?.metadata?.name || 'Unknown Token',
          decimals: asset.token_info.decimals,
          balance: asset.token_info.balance,
          uiBalance,
          usdValue: asset.token_info.price_info
            ? uiBalance * asset.token_info.price_info.price_per_token
            : null,
          logoURI: knownToken?.logoURI || asset.content?.links?.image,
        });
      }
    } catch (error) {
      console.error('Error fetching SPL tokens:', error);
    }
  }

  // Sort by USD value (highest first), then by balance
  return balances.sort((a, b) => {
    if (a.isNative) return -1;
    if (b.isNative) return 1;
    if (a.usdValue && b.usdValue) return b.usdValue - a.usdValue;
    if (a.usdValue) return -1;
    if (b.usdValue) return 1;
    return b.uiBalance - a.uiBalance;
  });
}

export async function fetchTokenPrices(mints: string[]): Promise<Record<string, number>> {
  // Use Jupiter price API
  try {
    const response = await fetch(
      `https://price.jup.ag/v6/price?ids=${mints.join(',')}`
    );
    const data = await response.json();

    const prices: Record<string, number> = {};
    for (const [mint, info] of Object.entries(data.data || {})) {
      prices[mint] = (info as { price: number }).price;
    }
    return prices;
  } catch (error) {
    console.error('Error fetching prices:', error);
    return {};
  }
}
```

**Verification:**
```typescript
// Test in component:
import { fetchBalances } from '@/lib/solana/tokens';
const balances = await fetchBalances('YOUR_PUBLIC_KEY');
console.log(balances);
```

---

### Task 4.2.2: Create Transaction Builders

**File:** `src/lib/solana/transactions.ts`

**Code:**
```typescript
import {
  Connection,
  PublicKey,
  Transaction,
  SystemProgram,
  LAMPORTS_PER_SOL,
  Keypair,
  sendAndConfirmTransaction,
} from '@solana/web3.js';
import {
  getAssociatedTokenAddress,
  createTransferInstruction,
  createAssociatedTokenAccountInstruction,
  getAccount,
  TokenAccountNotFoundError,
} from '@solana/spl-token';
import { getConnection } from './connection';
import { TransactionResult } from '@/types/token';
import { SOL_MINT } from '@/constants/tokens';

export function validateSolanaAddress(address: string): boolean {
  try {
    new PublicKey(address);
    return true;
  } catch {
    return false;
  }
}

export function shortenAddress(address: string, chars = 4): string {
  return `${address.slice(0, chars)}...${address.slice(-chars)}`;
}

export async function sendSOL(
  fromKeypair: Keypair,
  toAddress: string,
  amount: number // in SOL
): Promise<TransactionResult> {
  const connection = getConnection();

  try {
    const toPubkey = new PublicKey(toAddress);
    const lamports = Math.floor(amount * LAMPORTS_PER_SOL);

    const transaction = new Transaction().add(
      SystemProgram.transfer({
        fromPubkey: fromKeypair.publicKey,
        toPubkey,
        lamports,
      })
    );

    const signature = await sendAndConfirmTransaction(connection, transaction, [
      fromKeypair,
    ]);

    return { signature, status: 'success' };
  } catch (error) {
    console.error('Error sending SOL:', error);
    return {
      signature: '',
      status: 'failed',
      error: (error as Error).message,
    };
  }
}

export async function sendSPLToken(
  fromKeypair: Keypair,
  toAddress: string,
  mint: string,
  amount: number, // UI amount (will be converted with decimals)
  decimals: number
): Promise<TransactionResult> {
  const connection = getConnection();

  try {
    const mintPubkey = new PublicKey(mint);
    const toPubkey = new PublicKey(toAddress);

    // Get source token account
    const sourceATA = await getAssociatedTokenAddress(
      mintPubkey,
      fromKeypair.publicKey
    );

    // Get or create destination token account
    const destATA = await getAssociatedTokenAddress(mintPubkey, toPubkey);

    const transaction = new Transaction();

    // Check if destination ATA exists
    try {
      await getAccount(connection, destATA);
    } catch (error) {
      if (error instanceof TokenAccountNotFoundError) {
        // Create ATA for recipient
        transaction.add(
          createAssociatedTokenAccountInstruction(
            fromKeypair.publicKey,
            destATA,
            toPubkey,
            mintPubkey
          )
        );
      } else {
        throw error;
      }
    }

    // Add transfer instruction
    const tokenAmount = BigInt(Math.floor(amount * Math.pow(10, decimals)));
    transaction.add(
      createTransferInstruction(sourceATA, destATA, fromKeypair.publicKey, tokenAmount)
    );

    const signature = await sendAndConfirmTransaction(connection, transaction, [
      fromKeypair,
    ]);

    return { signature, status: 'success' };
  } catch (error) {
    console.error('Error sending SPL token:', error);
    return {
      signature: '',
      status: 'failed',
      error: (error as Error).message,
    };
  }
}

export async function estimateTransactionFee(): Promise<number> {
  const connection = getConnection();
  const { feeCalculator } = await connection.getRecentBlockhash();
  // Estimate for a simple transfer (usually 5000 lamports)
  return (feeCalculator?.lamportsPerSignature || 5000) / LAMPORTS_PER_SOL;
}
```

**Verification:**
```bash
cd /Users/lucasbertol/zenwallet && npm run build
# Should compile without type errors
```

---

## Batch 4.3: Balance Hook & Components

### Task 4.3.1: Create useBalance Hook

**File:** `src/hooks/useBalance.ts`

**Code:**
```typescript
import { useState, useEffect, useCallback } from 'react';
import { TokenBalance } from '@/types/token';
import { fetchBalances, fetchTokenPrices } from '@/lib/solana/tokens';
import { useWalletStore } from '@/stores/walletStore';
import { SOL_MINT } from '@/constants/tokens';

interface UseBalanceReturn {
  balances: TokenBalance[];
  totalUsdValue: number;
  isLoading: boolean;
  error: string | null;
  refresh: () => Promise<void>;
}

export function useBalance(): UseBalanceReturn {
  const { publicKey } = useWalletStore();
  const [balances, setBalances] = useState<TokenBalance[]>([]);
  const [totalUsdValue, setTotalUsdValue] = useState(0);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const refresh = useCallback(async () => {
    if (!publicKey) {
      setBalances([]);
      setTotalUsdValue(0);
      setIsLoading(false);
      return;
    }

    setIsLoading(true);
    setError(null);

    try {
      // Fetch balances
      const fetchedBalances = await fetchBalances(publicKey);

      // Fetch prices for tokens without USD value
      const mintsNeedingPrices = fetchedBalances
        .filter((b) => b.usdValue === null)
        .map((b) => b.mint);

      if (mintsNeedingPrices.length > 0) {
        const prices = await fetchTokenPrices(mintsNeedingPrices);

        // Update balances with prices
        for (const balance of fetchedBalances) {
          if (balance.usdValue === null && prices[balance.mint]) {
            balance.usdValue = balance.uiBalance * prices[balance.mint];
          }
        }
      }

      setBalances(fetchedBalances);

      // Calculate total USD value
      const total = fetchedBalances.reduce(
        (sum, b) => sum + (b.usdValue || 0),
        0
      );
      setTotalUsdValue(total);
    } catch (err) {
      setError((err as Error).message);
    } finally {
      setIsLoading(false);
    }
  }, [publicKey]);

  useEffect(() => {
    refresh();

    // Auto-refresh every 30 seconds
    const interval = setInterval(refresh, 30000);
    return () => clearInterval(interval);
  }, [refresh]);

  return { balances, totalUsdValue, isLoading, error, refresh };
}

// Helper to get SOL balance specifically
export function useSOLBalance(): {
  balance: number;
  usdValue: number | null;
  isLoading: boolean;
} {
  const { balances, isLoading } = useBalance();
  const solBalance = balances.find((b) => b.mint === SOL_MINT);

  return {
    balance: solBalance?.uiBalance || 0,
    usdValue: solBalance?.usdValue || null,
    isLoading,
  };
}
```

**Verification:**
```typescript
// In any component:
const { balances, totalUsdValue, isLoading } = useBalance();
console.log('Total USD:', totalUsdValue);
```

---

### Task 4.3.2: Create BalanceCard Component

**File:** `src/components/wallet/BalanceCard.tsx`

**Code:**
```typescript
import { motion } from 'framer-motion';
import { useState } from 'react';
import { useBalance } from '@/hooks/useBalance';
import { Button } from '@/components/ui/Button';
import { SendModal } from './SendModal';
import { ReceiveModal } from './ReceiveModal';

interface BalanceCardProps {
  onSwapClick?: () => void;
}

export function BalanceCard({ onSwapClick }: BalanceCardProps) {
  const { totalUsdValue, isLoading, refresh } = useBalance();
  const [showSend, setShowSend] = useState(false);
  const [showReceive, setShowReceive] = useState(false);

  const formatUSD = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(value);
  };

  return (
    <>
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="bg-gradient-card rounded-2xl p-6 shadow-lg"
      >
        {/* Total Balance */}
        <div className="text-center mb-6">
          <p className="text-text-muted text-sm mb-1">Total Balance</p>
          {isLoading ? (
            <div className="h-12 w-32 mx-auto bg-bg-tertiary animate-pulse rounded-lg" />
          ) : (
            <motion.h2
              key={totalUsdValue}
              initial={{ scale: 0.95 }}
              animate={{ scale: 1 }}
              className="text-display text-4xl bg-gradient-xp bg-clip-text text-transparent"
            >
              {formatUSD(totalUsdValue)}
            </motion.h2>
          )}
        </div>

        {/* Quick Actions */}
        <div className="grid grid-cols-3 gap-3">
          <Button
            variant="secondary"
            size="sm"
            onClick={() => setShowSend(true)}
            className="flex-col gap-1 py-4"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 11l5-5m0 0l5 5m-5-5v12" />
            </svg>
            <span className="text-xs">Send</span>
          </Button>

          <Button
            variant="secondary"
            size="sm"
            onClick={() => setShowReceive(true)}
            className="flex-col gap-1 py-4"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 13l-5 5m0 0l-5-5m5 5V6" />
            </svg>
            <span className="text-xs">Receive</span>
          </Button>

          <Button
            variant="primary"
            size="sm"
            onClick={onSwapClick}
            className="flex-col gap-1 py-4"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
            </svg>
            <span className="text-xs">Swap</span>
          </Button>
        </div>

        {/* Refresh button */}
        <button
          onClick={refresh}
          disabled={isLoading}
          className="absolute top-4 right-4 text-text-muted hover:text-text-primary transition-colors"
        >
          <svg
            className={`w-5 h-5 ${isLoading ? 'animate-spin' : ''}`}
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        </button>
      </motion.div>

      {/* Modals */}
      <SendModal isOpen={showSend} onClose={() => setShowSend(false)} />
      <ReceiveModal isOpen={showReceive} onClose={() => setShowReceive(false)} />
    </>
  );
}
```

**Verification:**
- Import and render BalanceCard in Home page
- Should show total USD balance
- Send/Receive/Swap buttons should be visible

---

### Task 4.3.3: Create TokenList Component

**File:** `src/components/wallet/TokenList.tsx`

**Code:**
```typescript
import { motion } from 'framer-motion';
import { useBalance } from '@/hooks/useBalance';
import { TokenBalance } from '@/types/token';

interface TokenRowProps {
  token: TokenBalance;
  index: number;
}

function TokenRow({ token, index }: TokenRowProps) {
  const formatBalance = (value: number) => {
    if (value < 0.001) return '<0.001';
    if (value < 1) return value.toFixed(4);
    if (value < 1000) return value.toFixed(2);
    return value.toLocaleString(undefined, { maximumFractionDigits: 2 });
  };

  const formatUSD = (value: number | null) => {
    if (value === null) return '-';
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(value);
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      transition={{ delay: index * 0.05 }}
      className="flex items-center justify-between p-4 bg-bg-secondary rounded-xl hover:bg-bg-tertiary transition-colors"
    >
      <div className="flex items-center gap-3">
        {/* Token Logo */}
        <div className="w-10 h-10 rounded-full bg-bg-tertiary flex items-center justify-center overflow-hidden">
          {token.logoURI ? (
            <img
              src={token.logoURI}
              alt={token.symbol}
              className="w-full h-full object-cover"
              onError={(e) => {
                (e.target as HTMLImageElement).style.display = 'none';
              }}
            />
          ) : (
            <span className="text-lg font-bold text-text-muted">
              {token.symbol.charAt(0)}
            </span>
          )}
        </div>

        {/* Token Info */}
        <div>
          <h3 className="font-semibold text-text-primary">{token.symbol}</h3>
          <p className="text-sm text-text-muted">{token.name}</p>
        </div>
      </div>

      {/* Balance */}
      <div className="text-right">
        <p className="font-semibold text-text-primary">
          {formatBalance(token.uiBalance)}
        </p>
        <p className="text-sm text-text-muted">{formatUSD(token.usdValue)}</p>
      </div>
    </motion.div>
  );
}

export function TokenList() {
  const { balances, isLoading, error } = useBalance();

  if (isLoading) {
    return (
      <div className="space-y-3">
        {[1, 2, 3].map((i) => (
          <div
            key={i}
            className="h-20 bg-bg-secondary rounded-xl animate-pulse"
          />
        ))}
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-center py-8">
        <p className="text-error">{error}</p>
      </div>
    );
  }

  if (balances.length === 0) {
    return (
      <div className="text-center py-8">
        <p className="text-text-muted">No tokens found</p>
        <p className="text-sm text-text-muted mt-1">
          Add SOL to your wallet to get started
        </p>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {balances.map((token, index) => (
        <TokenRow key={token.mint} token={token} index={index} />
      ))}
    </div>
  );
}
```

**Verification:**
- Import and render in Assets page
- Should show list of tokens with balances
- Loading skeleton should appear initially

---

## Batch 4.4: Send Transaction

### Task 4.4.1: Create useTransaction Hook

**File:** `src/hooks/useTransaction.ts`

**Code:**
```typescript
import { useState, useCallback } from 'react';
import { useWalletStore } from '@/stores/walletStore';
import { useGamificationStore } from '@/stores/gamificationStore';
import { sendSOL, sendSPLToken, validateSolanaAddress } from '@/lib/solana/transactions';
import { TransactionResult, TokenBalance } from '@/types/token';
import { SOL_MINT } from '@/constants/tokens';

interface UseTransactionReturn {
  send: (
    toAddress: string,
    amount: number,
    token: TokenBalance
  ) => Promise<TransactionResult>;
  isLoading: boolean;
  error: string | null;
  validateAddress: (address: string) => boolean;
}

export function useTransaction(): UseTransactionReturn {
  const { getKeypair, publicKey } = useWalletStore();
  const { addXP, incrementStat } = useGamificationStore();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const send = useCallback(
    async (
      toAddress: string,
      amount: number,
      token: TokenBalance
    ): Promise<TransactionResult> => {
      setIsLoading(true);
      setError(null);

      // Validate
      if (!validateSolanaAddress(toAddress)) {
        setError('Invalid recipient address');
        setIsLoading(false);
        return { signature: '', status: 'failed', error: 'Invalid address' };
      }

      if (toAddress === publicKey) {
        setError('Cannot send to yourself');
        setIsLoading(false);
        return { signature: '', status: 'failed', error: 'Cannot send to yourself' };
      }

      if (amount <= 0) {
        setError('Amount must be greater than 0');
        setIsLoading(false);
        return { signature: '', status: 'failed', error: 'Invalid amount' };
      }

      if (amount > token.uiBalance) {
        setError('Insufficient balance');
        setIsLoading(false);
        return { signature: '', status: 'failed', error: 'Insufficient balance' };
      }

      const keypair = getKeypair();
      if (!keypair) {
        setError('Wallet not unlocked');
        setIsLoading(false);
        return { signature: '', status: 'failed', error: 'Wallet not unlocked' };
      }

      try {
        let result: TransactionResult;

        if (token.mint === SOL_MINT || token.isNative) {
          result = await sendSOL(keypair, toAddress, amount);
        } else {
          result = await sendSPLToken(
            keypair,
            toAddress,
            token.mint,
            amount,
            token.decimals
          );
        }

        if (result.status === 'success') {
          // Gamification rewards
          addXP('send');
          incrementStat('totalTransactions');
        } else {
          setError(result.error || 'Transaction failed');
        }

        setIsLoading(false);
        return result;
      } catch (err) {
        const errorMessage = (err as Error).message;
        setError(errorMessage);
        setIsLoading(false);
        return { signature: '', status: 'failed', error: errorMessage };
      }
    },
    [getKeypair, publicKey, addXP, incrementStat]
  );

  return {
    send,
    isLoading,
    error,
    validateAddress: validateSolanaAddress,
  };
}
```

**Verification:**
```bash
npm run build
# Check for type errors
```

---

### Task 4.4.2: Create SendModal Component

**File:** `src/components/wallet/SendModal.tsx`

**Code:**
```typescript
import { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Modal } from '@/components/ui/Modal';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';
import { useBalance } from '@/hooks/useBalance';
import { useTransaction } from '@/hooks/useTransaction';
import { TokenBalance } from '@/types/token';
import { shortenAddress } from '@/lib/solana/transactions';
import { getExplorerUrl } from '@/lib/solana/connection';

interface SendModalProps {
  isOpen: boolean;
  onClose: () => void;
  preselectedToken?: TokenBalance;
}

type Step = 'form' | 'confirm' | 'success' | 'error';

export function SendModal({ isOpen, onClose, preselectedToken }: SendModalProps) {
  const { balances } = useBalance();
  const { send, isLoading, error, validateAddress } = useTransaction();

  const [step, setStep] = useState<Step>('form');
  const [selectedToken, setSelectedToken] = useState<TokenBalance | null>(null);
  const [recipient, setRecipient] = useState('');
  const [amount, setAmount] = useState('');
  const [txSignature, setTxSignature] = useState('');

  // Reset state when modal opens/closes
  useEffect(() => {
    if (isOpen) {
      setStep('form');
      setRecipient('');
      setAmount('');
      setTxSignature('');
      setSelectedToken(preselectedToken || balances[0] || null);
    }
  }, [isOpen, preselectedToken, balances]);

  const handleMaxClick = () => {
    if (selectedToken) {
      // Leave some SOL for fees if sending SOL
      const maxAmount = selectedToken.isNative
        ? Math.max(0, selectedToken.uiBalance - 0.01)
        : selectedToken.uiBalance;
      setAmount(maxAmount.toString());
    }
  };

  const handleContinue = () => {
    if (!selectedToken || !recipient || !amount) return;
    if (!validateAddress(recipient)) return;
    if (parseFloat(amount) > selectedToken.uiBalance) return;
    setStep('confirm');
  };

  const handleConfirm = async () => {
    if (!selectedToken) return;

    const result = await send(recipient, parseFloat(amount), selectedToken);

    if (result.status === 'success') {
      setTxSignature(result.signature);
      setStep('success');
    } else {
      setStep('error');
    }
  };

  const handleClose = () => {
    setStep('form');
    onClose();
  };

  return (
    <Modal isOpen={isOpen} onClose={handleClose} title="Send">
      <AnimatePresence mode="wait">
        {/* Step: Form */}
        {step === 'form' && (
          <motion.div
            key="form"
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            exit={{ opacity: 0, x: -20 }}
            className="space-y-4"
          >
            {/* Token Selector */}
            <div>
              <label className="text-sm text-text-secondary mb-2 block">Token</label>
              <select
                value={selectedToken?.mint || ''}
                onChange={(e) => {
                  const token = balances.find((b) => b.mint === e.target.value);
                  setSelectedToken(token || null);
                }}
                className="w-full bg-bg-tertiary border border-text-muted/20 rounded-xl py-3 px-4 text-text-primary"
              >
                {balances.map((token) => (
                  <option key={token.mint} value={token.mint}>
                    {token.symbol} - {token.uiBalance.toFixed(4)}
                  </option>
                ))}
              </select>
            </div>

            {/* Recipient */}
            <Input
              label="Recipient Address"
              value={recipient}
              onChange={(e) => setRecipient(e.target.value)}
              placeholder="Enter Solana address"
              error={recipient && !validateAddress(recipient) ? 'Invalid address' : undefined}
            />

            {/* Amount */}
            <div>
              <div className="flex justify-between mb-2">
                <label className="text-sm text-text-secondary">Amount</label>
                <button
                  onClick={handleMaxClick}
                  className="text-sm text-solana-green hover:underline"
                >
                  Max
                </button>
              </div>
              <Input
                type="number"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                placeholder="0.00"
                error={
                  amount && selectedToken && parseFloat(amount) > selectedToken.uiBalance
                    ? 'Insufficient balance'
                    : undefined
                }
                rightElement={
                  <span className="text-text-muted">{selectedToken?.symbol}</span>
                }
              />
            </div>

            <Button
              variant="primary"
              size="lg"
              className="w-full"
              onClick={handleContinue}
              disabled={
                !selectedToken ||
                !recipient ||
                !amount ||
                !validateAddress(recipient) ||
                parseFloat(amount) > (selectedToken?.uiBalance || 0)
              }
            >
              Continue
            </Button>
          </motion.div>
        )}

        {/* Step: Confirm */}
        {step === 'confirm' && selectedToken && (
          <motion.div
            key="confirm"
            initial={{ opacity: 0, x: 20 }}
            animate={{ opacity: 1, x: 0 }}
            exit={{ opacity: 0, x: -20 }}
            className="space-y-4"
          >
            <div className="bg-bg-tertiary rounded-xl p-4 space-y-3">
              <div className="flex justify-between">
                <span className="text-text-muted">Sending</span>
                <span className="text-text-primary font-semibold">
                  {amount} {selectedToken.symbol}
                </span>
              </div>
              <div className="flex justify-between">
                <span className="text-text-muted">To</span>
                <span className="text-text-primary font-mono text-sm">
                  {shortenAddress(recipient, 6)}
                </span>
              </div>
              <div className="flex justify-between">
                <span className="text-text-muted">Network Fee</span>
                <span className="text-text-primary">~0.000005 SOL</span>
              </div>
            </div>

            {error && (
              <p className="text-error text-sm">{error}</p>
            )}

            <div className="flex gap-3">
              <Button
                variant="secondary"
                size="lg"
                className="flex-1"
                onClick={() => setStep('form')}
              >
                Back
              </Button>
              <Button
                variant="primary"
                size="lg"
                className="flex-1"
                onClick={handleConfirm}
                isLoading={isLoading}
              >
                Confirm
              </Button>
            </div>
          </motion.div>
        )}

        {/* Step: Success */}
        {step === 'success' && (
          <motion.div
            key="success"
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            className="text-center py-4"
          >
            <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-success/20 flex items-center justify-center">
              <svg className="w-8 h-8 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h3 className="text-heading text-success mb-2">Sent!</h3>
            <p className="text-text-secondary mb-4">
              Your transaction has been confirmed
            </p>
            <a
              href={getExplorerUrl(txSignature)}
              target="_blank"
              rel="noopener noreferrer"
              className="text-solana-green hover:underline text-sm"
            >
              View on Explorer →
            </a>
            <Button
              variant="primary"
              size="lg"
              className="w-full mt-6"
              onClick={handleClose}
            >
              Done
            </Button>
          </motion.div>
        )}

        {/* Step: Error */}
        {step === 'error' && (
          <motion.div
            key="error"
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            className="text-center py-4"
          >
            <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-error/20 flex items-center justify-center">
              <svg className="w-8 h-8 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </div>
            <h3 className="text-heading text-error mb-2">Failed</h3>
            <p className="text-text-secondary mb-4">{error || 'Transaction failed'}</p>
            <Button
              variant="secondary"
              size="lg"
              className="w-full"
              onClick={() => setStep('form')}
            >
              Try Again
            </Button>
          </motion.div>
        )}
      </AnimatePresence>
    </Modal>
  );
}
```

**Verification:**
- Open SendModal from BalanceCard
- Select token, enter address and amount
- Confirm flow should work

---

### Task 4.4.3: Install SPL Token Dependency

**Command:**
```bash
cd /Users/lucasbertol/zenwallet && npm install @solana/spl-token
```

**Verification:**
```bash
npm list @solana/spl-token
# Should show @solana/spl-token@0.4.x
```

---

## Batch 4.5: Receive Modal

### Task 4.5.1: Create ReceiveModal Component

**File:** `src/components/wallet/ReceiveModal.tsx`

**Code:**
```typescript
import { useState } from 'react';
import { motion } from 'framer-motion';
import { QRCodeSVG } from 'qrcode.react';
import { Modal } from '@/components/ui/Modal';
import { Button } from '@/components/ui/Button';
import { useWalletStore } from '@/stores/walletStore';
import { shortenAddress } from '@/lib/solana/transactions';

interface ReceiveModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function ReceiveModal({ isOpen, onClose }: ReceiveModalProps) {
  const { publicKey } = useWalletStore();
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    if (!publicKey) return;

    try {
      await navigator.clipboard.writeText(publicKey);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (error) {
      console.error('Failed to copy:', error);
    }
  };

  if (!publicKey) return null;

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Receive">
      <div className="text-center">
        {/* QR Code */}
        <motion.div
          initial={{ scale: 0.9, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          className="bg-white p-4 rounded-2xl inline-block mb-6"
        >
          <QRCodeSVG
            value={publicKey}
            size={200}
            level="H"
            includeMargin={false}
            bgColor="#FFFFFF"
            fgColor="#0A0A0B"
          />
        </motion.div>

        {/* Address */}
        <p className="text-text-muted text-sm mb-2">Your Solana Address</p>
        <div className="bg-bg-tertiary rounded-xl p-4 mb-4">
          <p className="font-mono text-sm text-text-primary break-all">
            {publicKey}
          </p>
        </div>

        {/* Copy Button */}
        <Button
          variant={copied ? 'primary' : 'secondary'}
          size="lg"
          className="w-full"
          onClick={handleCopy}
        >
          {copied ? (
            <>
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
              </svg>
              Copied!
            </>
          ) : (
            <>
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                />
              </svg>
              Copy Address
            </>
          )}
        </Button>

        {/* Warning */}
        <p className="text-text-muted text-xs mt-4">
          Only send Solana (SOL) and SPL tokens to this address
        </p>
      </div>
    </Modal>
  );
}
```

**Verification:**
- Click "Receive" from BalanceCard
- QR Code should render correctly
- Copy button should work and show "Copied!" feedback

---

## Batch 4.6: Jupiter Swap Integration

### Task 4.6.1: Create Jupiter Client

**File:** `src/lib/jupiter/client.ts`

**Code:**
```typescript
import { Keypair, VersionedTransaction, Connection } from '@solana/web3.js';
import { getConnection } from '@/lib/solana/connection';
import { ZENWALLET_FEE_BPS } from '@/constants/tokens';

const JUPITER_API_URL = 'https://quote-api.jup.ag/v6';

export interface JupiterQuote {
  inputMint: string;
  inAmount: string;
  outputMint: string;
  outAmount: string;
  priceImpactPct: string;
  routePlan: Array<{
    swapInfo: {
      ammKey: string;
      label: string;
      inputMint: string;
      outputMint: string;
      inAmount: string;
      outAmount: string;
      feeAmount: string;
      feeMint: string;
    };
    percent: number;
  }>;
}

export interface SwapResult {
  signature: string;
  status: 'success' | 'failed';
  error?: string;
}

export async function getQuote(
  inputMint: string,
  outputMint: string,
  amount: number, // In smallest unit (lamports for SOL)
  slippageBps: number = 50 // 0.5% default slippage
): Promise<JupiterQuote | null> {
  try {
    const params = new URLSearchParams({
      inputMint,
      outputMint,
      amount: amount.toString(),
      slippageBps: slippageBps.toString(),
      platformFeeBps: ZENWALLET_FEE_BPS.toString(),
    });

    const response = await fetch(`${JUPITER_API_URL}/quote?${params}`);

    if (!response.ok) {
      throw new Error(`Quote failed: ${response.statusText}`);
    }

    return await response.json();
  } catch (error) {
    console.error('Error getting quote:', error);
    return null;
  }
}

export async function executeSwap(
  quote: JupiterQuote,
  userPublicKey: string,
  keypair: Keypair
): Promise<SwapResult> {
  const connection = getConnection();

  try {
    // Get swap transaction
    const swapResponse = await fetch(`${JUPITER_API_URL}/swap`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        quoteResponse: quote,
        userPublicKey,
        wrapAndUnwrapSol: true,
        dynamicComputeUnitLimit: true,
        prioritizationFeeLamports: 'auto',
      }),
    });

    if (!swapResponse.ok) {
      throw new Error(`Swap request failed: ${swapResponse.statusText}`);
    }

    const swapData = await swapResponse.json();
    const swapTransactionBuf = Buffer.from(swapData.swapTransaction, 'base64');
    const transaction = VersionedTransaction.deserialize(swapTransactionBuf);

    // Sign transaction
    transaction.sign([keypair]);

    // Send transaction
    const rawTransaction = transaction.serialize();
    const signature = await connection.sendRawTransaction(rawTransaction, {
      skipPreflight: true,
      maxRetries: 3,
    });

    // Confirm transaction
    const latestBlockHash = await connection.getLatestBlockhash();
    await connection.confirmTransaction({
      blockhash: latestBlockHash.blockhash,
      lastValidBlockHeight: latestBlockHash.lastValidBlockHeight,
      signature,
    });

    return { signature, status: 'success' };
  } catch (error) {
    console.error('Error executing swap:', error);
    return {
      signature: '',
      status: 'failed',
      error: (error as Error).message,
    };
  }
}

export function calculateOutputAmount(
  inputAmount: number,
  inputDecimals: number,
  quote: JupiterQuote,
  outputDecimals: number
): number {
  const outAmount = parseInt(quote.outAmount);
  return outAmount / Math.pow(10, outputDecimals);
}

export function calculatePriceImpact(quote: JupiterQuote): number {
  return parseFloat(quote.priceImpactPct) * 100;
}
```

**Verification:**
```typescript
// Test quote fetch:
import { getQuote } from '@/lib/jupiter/client';
const quote = await getQuote(
  'So11111111111111111111111111111111111111112', // SOL
  'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', // USDC
  1000000000 // 1 SOL in lamports
);
console.log(quote);
```

---

### Task 4.6.2: Create useSwap Hook

**File:** `src/hooks/useSwap.ts`

**Code:**
```typescript
import { useState, useCallback } from 'react';
import { useWalletStore } from '@/stores/walletStore';
import { useGamificationStore } from '@/stores/gamificationStore';
import {
  getQuote,
  executeSwap,
  JupiterQuote,
  SwapResult,
} from '@/lib/jupiter/client';
import { TokenBalance } from '@/types/token';

interface UseSwapReturn {
  quote: JupiterQuote | null;
  isLoadingQuote: boolean;
  isSwapping: boolean;
  error: string | null;
  fetchQuote: (
    inputToken: TokenBalance,
    outputMint: string,
    amount: number
  ) => Promise<void>;
  swap: () => Promise<SwapResult>;
  clearQuote: () => void;
}

export function useSwap(): UseSwapReturn {
  const { getKeypair, publicKey } = useWalletStore();
  const { addXP, incrementStat } = useGamificationStore();

  const [quote, setQuote] = useState<JupiterQuote | null>(null);
  const [isLoadingQuote, setIsLoadingQuote] = useState(false);
  const [isSwapping, setIsSwapping] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchQuote = useCallback(
    async (inputToken: TokenBalance, outputMint: string, amount: number) => {
      if (amount <= 0) {
        setQuote(null);
        return;
      }

      setIsLoadingQuote(true);
      setError(null);

      try {
        // Convert UI amount to smallest unit
        const inputAmount = Math.floor(amount * Math.pow(10, inputToken.decimals));

        const fetchedQuote = await getQuote(
          inputToken.mint,
          outputMint,
          inputAmount
        );

        if (!fetchedQuote) {
          setError('Unable to get quote. Try a different amount or pair.');
          setQuote(null);
        } else {
          setQuote(fetchedQuote);
        }
      } catch (err) {
        setError((err as Error).message);
        setQuote(null);
      } finally {
        setIsLoadingQuote(false);
      }
    },
    []
  );

  const swap = useCallback(async (): Promise<SwapResult> => {
    if (!quote || !publicKey) {
      return { signature: '', status: 'failed', error: 'Missing quote or wallet' };
    }

    const keypair = getKeypair();
    if (!keypair) {
      return { signature: '', status: 'failed', error: 'Wallet not unlocked' };
    }

    setIsSwapping(true);
    setError(null);

    try {
      const result = await executeSwap(quote, publicKey, keypair);

      if (result.status === 'success') {
        // Gamification rewards
        addXP('swap');
        incrementStat('totalSwaps');
        setQuote(null);
      } else {
        setError(result.error || 'Swap failed');
      }

      return result;
    } catch (err) {
      const errorMessage = (err as Error).message;
      setError(errorMessage);
      return { signature: '', status: 'failed', error: errorMessage };
    } finally {
      setIsSwapping(false);
    }
  }, [quote, publicKey, getKeypair, addXP, incrementStat]);

  const clearQuote = useCallback(() => {
    setQuote(null);
    setError(null);
  }, []);

  return {
    quote,
    isLoadingQuote,
    isSwapping,
    error,
    fetchQuote,
    swap,
    clearQuote,
  };
}
```

**Verification:**
```bash
npm run build
# Should compile without errors
```

---

### Task 4.6.3: Create SwapInterface Component

**File:** `src/components/wallet/SwapInterface.tsx`

**Code:**
```typescript
import { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Button } from '@/components/ui/Button';
import { useBalance } from '@/hooks/useBalance';
import { useSwap } from '@/hooks/useSwap';
import { TokenBalance } from '@/types/token';
import { KNOWN_TOKENS, SOL_MINT, ZENWALLET_FEE_BPS } from '@/constants/tokens';
import { getExplorerUrl } from '@/lib/solana/connection';

// Popular swap pairs
const SWAP_TOKENS = [
  SOL_MINT,
  'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', // USDC
  'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB', // USDT
  'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263', // BONK
];

export function SwapInterface() {
  const { balances } = useBalance();
  const { quote, isLoadingQuote, isSwapping, error, fetchQuote, swap, clearQuote } = useSwap();

  const [inputToken, setInputToken] = useState<TokenBalance | null>(null);
  const [outputMint, setOutputMint] = useState<string>(
    'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v'
  );
  const [inputAmount, setInputAmount] = useState('');
  const [txSignature, setTxSignature] = useState<string | null>(null);

  // Set initial input token
  useEffect(() => {
    if (balances.length > 0 && !inputToken) {
      setInputToken(balances[0]);
    }
  }, [balances, inputToken]);

  // Debounced quote fetch
  useEffect(() => {
    const timer = setTimeout(() => {
      if (inputToken && outputMint && parseFloat(inputAmount) > 0) {
        fetchQuote(inputToken, outputMint, parseFloat(inputAmount));
      } else {
        clearQuote();
      }
    }, 500);

    return () => clearTimeout(timer);
  }, [inputToken, outputMint, inputAmount, fetchQuote, clearQuote]);

  const handleSwapTokens = () => {
    if (!inputToken || !quote) return;

    const newInputMint = outputMint;
    const newOutputMint = inputToken.mint;

    // Find the token in balances
    const newInputToken = balances.find((b) => b.mint === newInputMint);

    if (newInputToken) {
      setInputToken(newInputToken);
      setOutputMint(newOutputMint);
      setInputAmount('');
    }
  };

  const handleMaxClick = () => {
    if (!inputToken) return;
    const maxAmount = inputToken.isNative
      ? Math.max(0, inputToken.uiBalance - 0.01)
      : inputToken.uiBalance;
    setInputAmount(maxAmount.toString());
  };

  const handleSwap = async () => {
    const result = await swap();
    if (result.status === 'success') {
      setTxSignature(result.signature);
      setInputAmount('');
    }
  };

  const formatAmount = (amount: string, decimals: number): string => {
    const value = parseInt(amount) / Math.pow(10, decimals);
    if (value < 0.001) return '<0.001';
    if (value < 1) return value.toFixed(6);
    return value.toLocaleString(undefined, { maximumFractionDigits: 4 });
  };

  const outputToken = KNOWN_TOKENS[outputMint];

  return (
    <div className="space-y-4">
      {/* Success Message */}
      <AnimatePresence>
        {txSignature && (
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            className="bg-success/10 border border-success/20 rounded-xl p-4"
          >
            <p className="text-success font-semibold mb-1">Swap Complete!</p>
            <a
              href={getExplorerUrl(txSignature)}
              target="_blank"
              rel="noopener noreferrer"
              className="text-sm text-solana-green hover:underline"
            >
              View on Explorer →
            </a>
            <button
              onClick={() => setTxSignature(null)}
              className="ml-4 text-sm text-text-muted hover:text-text-primary"
            >
              Dismiss
            </button>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Input Token */}
      <div className="bg-bg-secondary rounded-2xl p-4">
        <div className="flex justify-between mb-2">
          <span className="text-sm text-text-muted">You pay</span>
          <button
            onClick={handleMaxClick}
            className="text-sm text-solana-green hover:underline"
          >
            Max: {inputToken?.uiBalance.toFixed(4) || '0'}
          </button>
        </div>

        <div className="flex gap-3">
          <select
            value={inputToken?.mint || ''}
            onChange={(e) => {
              const token = balances.find((b) => b.mint === e.target.value);
              setInputToken(token || null);
            }}
            className="bg-bg-tertiary rounded-xl px-4 py-3 text-text-primary font-semibold"
          >
            {balances.map((token) => (
              <option key={token.mint} value={token.mint}>
                {token.symbol}
              </option>
            ))}
          </select>

          <input
            type="number"
            value={inputAmount}
            onChange={(e) => setInputAmount(e.target.value)}
            placeholder="0.00"
            className="flex-1 bg-transparent text-right text-2xl font-semibold text-text-primary placeholder:text-text-muted focus:outline-none"
          />
        </div>
      </div>

      {/* Swap Arrow */}
      <div className="flex justify-center -my-2 relative z-10">
        <button
          onClick={handleSwapTokens}
          disabled={!quote}
          className="w-10 h-10 bg-bg-tertiary rounded-xl flex items-center justify-center hover:bg-bg-secondary transition-colors"
        >
          <svg className="w-5 h-5 text-text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
          </svg>
        </button>
      </div>

      {/* Output Token */}
      <div className="bg-bg-secondary rounded-2xl p-4">
        <div className="flex justify-between mb-2">
          <span className="text-sm text-text-muted">You receive</span>
        </div>

        <div className="flex gap-3">
          <select
            value={outputMint}
            onChange={(e) => setOutputMint(e.target.value)}
            className="bg-bg-tertiary rounded-xl px-4 py-3 text-text-primary font-semibold"
          >
            {SWAP_TOKENS.filter((mint) => mint !== inputToken?.mint).map((mint) => (
              <option key={mint} value={mint}>
                {KNOWN_TOKENS[mint]?.symbol || 'UNKNOWN'}
              </option>
            ))}
          </select>

          <div className="flex-1 text-right">
            {isLoadingQuote ? (
              <div className="h-8 w-24 ml-auto bg-bg-tertiary animate-pulse rounded" />
            ) : quote ? (
              <span className="text-2xl font-semibold text-text-primary">
                {formatAmount(quote.outAmount, outputToken?.decimals || 6)}
              </span>
            ) : (
              <span className="text-2xl font-semibold text-text-muted">0.00</span>
            )}
          </div>
        </div>
      </div>

      {/* Quote Details */}
      {quote && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: 'auto' }}
          className="bg-bg-tertiary rounded-xl p-4 space-y-2 text-sm"
        >
          <div className="flex justify-between">
            <span className="text-text-muted">Price Impact</span>
            <span
              className={
                parseFloat(quote.priceImpactPct) > 1
                  ? 'text-warning'
                  : 'text-text-primary'
              }
            >
              {(parseFloat(quote.priceImpactPct) * 100).toFixed(2)}%
            </span>
          </div>
          <div className="flex justify-between">
            <span className="text-text-muted">ZenWallet Fee</span>
            <span className="text-text-primary">{ZENWALLET_FEE_BPS / 100}%</span>
          </div>
          <div className="flex justify-between">
            <span className="text-text-muted">Route</span>
            <span className="text-text-primary">
              {quote.routePlan.map((r) => r.swapInfo.label).join(' → ')}
            </span>
          </div>
        </motion.div>
      )}

      {/* Error */}
      {error && (
        <p className="text-error text-sm text-center">{error}</p>
      )}

      {/* Swap Button */}
      <Button
        variant="primary"
        size="lg"
        className="w-full"
        onClick={handleSwap}
        disabled={!quote || isSwapping || !inputAmount}
        isLoading={isSwapping}
      >
        {!inputAmount
          ? 'Enter amount'
          : !quote
          ? 'Getting quote...'
          : 'Swap'}
      </Button>
    </div>
  );
}
```

**Verification:**
- Navigate to Swap page
- Select tokens and enter amount
- Quote should appear with details
- Swap button should be enabled when quote is ready

---

### Task 4.6.4: Create Wallet Components Index

**File:** `src/components/wallet/index.ts`

**Code:**
```typescript
export { BalanceCard } from './BalanceCard';
export { TokenList } from './TokenList';
export { SendModal } from './SendModal';
export { ReceiveModal } from './ReceiveModal';
export { SwapInterface } from './SwapInterface';
```

**Verification:**
```typescript
// Should be able to import:
import { BalanceCard, TokenList, SendModal, ReceiveModal, SwapInterface } from '@/components/wallet';
```

---

## Batch 4.7: Page Implementations

### Task 4.7.1: Update Home Page

**File:** `src/pages/Home.tsx`

**Code:**
```typescript
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import { useWalletStore } from '@/stores/walletStore';
import { useGamificationStore } from '@/stores/gamificationStore';
import { BalanceCard, TokenList } from '@/components/wallet';
import { XPBar, StreakCounter } from '@/components/gamification';

export default function HomePage() {
  const navigate = useNavigate();
  const { publicKey, isUnlocked } = useWalletStore();
  const { checkStreak } = useGamificationStore();

  // Redirect to onboarding if no wallet
  useEffect(() => {
    if (!publicKey) {
      navigate('/onboarding');
    }
  }, [publicKey, navigate]);

  // Check streak on mount
  useEffect(() => {
    if (publicKey && isUnlocked) {
      checkStreak();
    }
  }, [publicKey, isUnlocked, checkStreak]);

  if (!publicKey) return null;

  return (
    <div className="min-h-screen p-6 pb-24">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="mb-6"
      >
        <h1 className="text-2xl font-bold bg-gradient-xp bg-clip-text text-transparent mb-4">
          ZenWallet
        </h1>
        <XPBar />
        <div className="mt-4">
          <StreakCounter />
        </div>
      </motion.div>

      {/* Balance Card */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.1 }}
        className="mb-6 relative"
      >
        <BalanceCard onSwapClick={() => navigate('/swap')} />
      </motion.div>

      {/* Token List Preview */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.2 }}
      >
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-lg font-semibold text-text-primary">Assets</h2>
          <button
            onClick={() => navigate('/assets')}
            className="text-sm text-solana-green hover:underline"
          >
            See all →
          </button>
        </div>
        <TokenList />
      </motion.div>
    </div>
  );
}
```

**Verification:**
- Navigate to "/" with wallet connected
- Should show XPBar, BalanceCard, and TokenList

---

### Task 4.7.2: Update Assets Page

**File:** `src/pages/Assets.tsx`

**Code:**
```typescript
import { motion } from 'framer-motion';
import { TokenList } from '@/components/wallet';
import { useBalance } from '@/hooks/useBalance';

export default function AssetsPage() {
  const { totalUsdValue, balances, refresh, isLoading } = useBalance();

  const formatUSD = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(value);
  };

  return (
    <div className="min-h-screen p-6 pb-24">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="mb-6"
      >
        <div className="flex justify-between items-center">
          <h1 className="text-heading">Assets</h1>
          <button
            onClick={refresh}
            disabled={isLoading}
            className="text-text-muted hover:text-text-primary transition-colors"
          >
            <svg
              className={`w-5 h-5 ${isLoading ? 'animate-spin' : ''}`}
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
          </button>
        </div>

        {/* Portfolio Value */}
        <div className="mt-4 bg-gradient-card rounded-xl p-4">
          <p className="text-text-muted text-sm mb-1">Portfolio Value</p>
          <p className="text-2xl font-bold text-text-primary">
            {formatUSD(totalUsdValue)}
          </p>
          <p className="text-text-muted text-sm mt-1">
            {balances.length} asset{balances.length !== 1 ? 's' : ''}
          </p>
        </div>
      </motion.div>

      {/* Token List */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.1 }}
      >
        <TokenList />
      </motion.div>
    </div>
  );
}
```

**Verification:**
- Navigate to "/assets"
- Should show portfolio value and full token list

---

### Task 4.7.3: Update Swap Page

**File:** `src/pages/Swap.tsx`

**Code:**
```typescript
import { motion } from 'framer-motion';
import { SwapInterface } from '@/components/wallet';

export default function SwapPage() {
  return (
    <div className="min-h-screen p-6 pb-24">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="mb-6"
      >
        <h1 className="text-heading">Swap</h1>
        <p className="text-text-muted text-sm mt-1">
          Exchange tokens instantly
        </p>
      </motion.div>

      {/* Swap Interface */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.1 }}
      >
        <SwapInterface />
      </motion.div>
    </div>
  );
}
```

**Verification:**
- Navigate to "/swap"
- SwapInterface should render
- Token selection and quote fetching should work

---

### Task 4.7.4: Update Achievements Page

**File:** `src/pages/Achievements.tsx`

**Code:**
```typescript
import { motion } from 'framer-motion';
import { useGamificationStore } from '@/stores/gamificationStore';
import { XPBar } from '@/components/gamification';
import { Achievement } from '@/types/gamification';

// Achievement definitions (should match gamificationStore)
const ALL_ACHIEVEMENTS: Achievement[] = [
  {
    id: 'first_steps',
    name: 'First Steps',
    description: 'Create your first wallet',
    icon: '🚀',
    xpBonus: 100,
    condition: () => true,
  },
  {
    id: 'first_send',
    name: 'First Send',
    description: 'Send your first transaction',
    icon: '💸',
    xpBonus: 50,
    condition: (stats) => stats.totalTransactions >= 1,
  },
  {
    id: 'swap_master',
    name: 'Swap Master',
    description: 'Complete your first swap',
    icon: '🔄',
    xpBonus: 50,
    condition: (stats) => stats.totalSwaps >= 1,
  },
  {
    id: 'week_warrior',
    name: 'Week Warrior',
    description: '7 day login streak',
    icon: '📅',
    xpBonus: 100,
    condition: (stats) => stats.currentStreak >= 7,
  },
  {
    id: 'monthly_legend',
    name: 'Monthly Legend',
    description: '30 day login streak',
    icon: '🔥',
    xpBonus: 500,
    condition: (stats) => stats.currentStreak >= 30,
  },
  {
    id: 'transaction_pro',
    name: 'Transaction Pro',
    description: '100 transactions',
    icon: '🎯',
    xpBonus: 300,
    condition: (stats) => stats.totalTransactions >= 100,
  },
  {
    id: 'dapp_explorer',
    name: 'dApp Explorer',
    description: 'Connect 5 dApps',
    icon: '🌐',
    xpBonus: 150,
    condition: (stats) => stats.dappsConnected >= 5,
  },
];

export default function AchievementsPage() {
  const { achievements, xp, level, stats } = useGamificationStore();

  const unlockedCount = achievements.length;
  const totalCount = ALL_ACHIEVEMENTS.length;

  return (
    <div className="min-h-screen p-6 pb-24">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="mb-6"
      >
        <h1 className="text-heading mb-4">Achievements</h1>
        <XPBar />

        {/* Stats */}
        <div className="grid grid-cols-3 gap-3 mt-4">
          <div className="bg-bg-secondary rounded-xl p-3 text-center">
            <p className="text-2xl font-bold text-solana-green">{level}</p>
            <p className="text-xs text-text-muted">Level</p>
          </div>
          <div className="bg-bg-secondary rounded-xl p-3 text-center">
            <p className="text-2xl font-bold text-accent-purple">{xp.toLocaleString()}</p>
            <p className="text-xs text-text-muted">Total XP</p>
          </div>
          <div className="bg-bg-secondary rounded-xl p-3 text-center">
            <p className="text-2xl font-bold text-warning">{unlockedCount}/{totalCount}</p>
            <p className="text-xs text-text-muted">Unlocked</p>
          </div>
        </div>
      </motion.div>

      {/* Achievement Grid */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.1 }}
        className="grid grid-cols-2 gap-3"
      >
        {ALL_ACHIEVEMENTS.map((achievement, index) => {
          const isUnlocked = achievements.includes(achievement.id);

          return (
            <motion.div
              key={achievement.id}
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: index * 0.05 }}
              className={`p-4 rounded-xl border ${
                isUnlocked
                  ? 'bg-gradient-card border-solana-green/30'
                  : 'bg-bg-secondary border-text-muted/10 opacity-60'
              }`}
            >
              <div className="text-4xl mb-2">{achievement.icon}</div>
              <h3 className="font-semibold text-text-primary text-sm">
                {achievement.name}
              </h3>
              <p className="text-xs text-text-muted mt-1">
                {achievement.description}
              </p>
              <p className="text-xs text-solana-green mt-2">
                +{achievement.xpBonus} XP
              </p>
              {isUnlocked && (
                <div className="mt-2 text-xs text-success flex items-center gap-1">
                  <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                  </svg>
                  Unlocked
                </div>
              )}
            </motion.div>
          );
        })}
      </motion.div>
    </div>
  );
}
```

**Verification:**
- Navigate to "/achievements"
- Should show XP stats and achievement grid
- Unlocked achievements should be highlighted

---

### Task 4.7.5: Update Settings Page

**File:** `src/pages/Settings.tsx`

**Code:**
```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import { useWalletStore } from '@/stores/walletStore';
import { Modal } from '@/components/ui/Modal';
import { Button } from '@/components/ui/Button';
import { getAddressExplorerUrl } from '@/lib/solana/connection';
import { shortenAddress } from '@/lib/solana/transactions';

export default function SettingsPage() {
  const navigate = useNavigate();
  const { publicKey, walletType, lockWallet, clearWallet } = useWalletStore();
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

  const handleLock = () => {
    lockWallet();
    navigate('/onboarding');
  };

  const handleDelete = async () => {
    await clearWallet();
    navigate('/onboarding');
  };

  return (
    <div className="min-h-screen p-6 pb-24">
      {/* Header */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="mb-6"
      >
        <h1 className="text-heading">Settings</h1>
      </motion.div>

      {/* Wallet Info */}
      {publicKey && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1 }}
          className="space-y-4"
        >
          {/* Wallet Section */}
          <div className="bg-bg-secondary rounded-xl p-4">
            <h3 className="text-sm text-text-muted mb-3">Wallet</h3>

            <div className="space-y-3">
              <div className="flex justify-between items-center">
                <span className="text-text-secondary">Address</span>
                <a
                  href={getAddressExplorerUrl(publicKey)}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-solana-green font-mono text-sm hover:underline"
                >
                  {shortenAddress(publicKey, 6)}
                </a>
              </div>

              <div className="flex justify-between items-center">
                <span className="text-text-secondary">Type</span>
                <span className="text-text-primary capitalize">
                  {walletType === 'internal' ? 'ZenWallet' : 'External'}
                </span>
              </div>
            </div>
          </div>

          {/* Security Section */}
          <div className="bg-bg-secondary rounded-xl p-4">
            <h3 className="text-sm text-text-muted mb-3">Security</h3>

            <div className="space-y-2">
              <button
                onClick={handleLock}
                className="w-full flex justify-between items-center py-3 text-text-primary hover:text-solana-green transition-colors"
              >
                <span>Lock Wallet</span>
                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
              </button>
            </div>
          </div>

          {/* Danger Zone */}
          <div className="bg-error/5 border border-error/20 rounded-xl p-4">
            <h3 className="text-sm text-error mb-3">Danger Zone</h3>

            <button
              onClick={() => setShowDeleteConfirm(true)}
              className="w-full flex justify-between items-center py-3 text-error hover:text-error/80 transition-colors"
            >
              <span>Delete Wallet</span>
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>

          {/* App Info */}
          <div className="text-center pt-4">
            <p className="text-text-muted text-sm">ZenWallet v1.1.0</p>
            <p className="text-text-muted text-xs mt-1">
              Crypto made fun. For real.
            </p>
          </div>
        </motion.div>
      )}

      {/* Delete Confirmation Modal */}
      <Modal
        isOpen={showDeleteConfirm}
        onClose={() => setShowDeleteConfirm(false)}
        title="Delete Wallet?"
      >
        <div className="space-y-4">
          <p className="text-text-secondary">
            This will permanently delete your wallet from this device. Make sure you have your recovery phrase backed up.
          </p>

          <div className="bg-error/10 border border-error/20 rounded-xl p-4">
            <p className="text-error text-sm">
              ⚠️ This action cannot be undone. Without your recovery phrase, you will lose access to your funds forever.
            </p>
          </div>

          <div className="flex gap-3">
            <Button
              variant="secondary"
              size="lg"
              className="flex-1"
              onClick={() => setShowDeleteConfirm(false)}
            >
              Cancel
            </Button>
            <Button
              variant="primary"
              size="lg"
              className="flex-1 !bg-error hover:!bg-error/80"
              onClick={handleDelete}
            >
              Delete
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
}
```

**Verification:**
- Navigate to "/settings"
- Should show wallet info, security options, and delete button
- Delete confirmation modal should work

---

## Batch 4.8: Auth Guard & Polish

### Task 4.8.1: Update App.tsx with Auth Guard and New Pages

**File:** `src/App.tsx`

**Code:**
```typescript
import { Routes, Route, useLocation, Navigate } from 'react-router-dom';
import { useEffect } from 'react';
import { SolanaProvider } from './providers/SolanaProvider';
import { BottomNav } from './components/ui/BottomNav';
import { useWalletStore } from './stores/walletStore';
import { XPGainNotification, AchievementPopup } from './components/gamification';

// Onboarding pages
import WelcomePage from './pages/onboarding/index';
import CreateWalletPage from './pages/onboarding/create';
import ImportWalletPage from './pages/onboarding/import';
import ConnectWalletPage from './pages/onboarding/connect';

// Main app pages
import HomePage from './pages/Home';
import AssetsPage from './pages/Assets';
import SwapPage from './pages/Swap';
import AchievementsPage from './pages/Achievements';
import SettingsPage from './pages/Settings';

// Auth guard component
function RequireWallet({ children }: { children: React.ReactNode }) {
  const { publicKey } = useWalletStore();

  if (!publicKey) {
    return <Navigate to="/onboarding" replace />;
  }

  return <>{children}</>;
}

// Redirect if already has wallet
function OnboardingGuard({ children }: { children: React.ReactNode }) {
  const { publicKey } = useWalletStore();

  if (publicKey) {
    return <Navigate to="/" replace />;
  }

  return <>{children}</>;
}

export default function App() {
  const location = useLocation();
  const isOnboarding = location.pathname.startsWith('/onboarding');

  return (
    <SolanaProvider>
      <div className="min-h-screen bg-bg-primary">
        {/* Gamification notifications */}
        <XPGainNotification />
        <AchievementPopup />

        <Routes>
          {/* Onboarding routes */}
          <Route
            path="/onboarding"
            element={
              <OnboardingGuard>
                <WelcomePage />
              </OnboardingGuard>
            }
          />
          <Route
            path="/onboarding/create"
            element={
              <OnboardingGuard>
                <CreateWalletPage />
              </OnboardingGuard>
            }
          />
          <Route
            path="/onboarding/import"
            element={
              <OnboardingGuard>
                <ImportWalletPage />
              </OnboardingGuard>
            }
          />
          <Route
            path="/onboarding/connect"
            element={
              <OnboardingGuard>
                <ConnectWalletPage />
              </OnboardingGuard>
            }
          />

          {/* Main app routes (protected) */}
          <Route
            path="/"
            element={
              <RequireWallet>
                <HomePage />
              </RequireWallet>
            }
          />
          <Route
            path="/assets"
            element={
              <RequireWallet>
                <AssetsPage />
              </RequireWallet>
            }
          />
          <Route
            path="/swap"
            element={
              <RequireWallet>
                <SwapPage />
              </RequireWallet>
            }
          />
          <Route
            path="/achievements"
            element={
              <RequireWallet>
                <AchievementsPage />
              </RequireWallet>
            }
          />
          <Route
            path="/settings"
            element={
              <RequireWallet>
                <SettingsPage />
              </RequireWallet>
            }
          />

          {/* Fallback */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>

        {/* Bottom navigation (only on main app) */}
        {!isOnboarding && <BottomNav />}
      </div>
    </SolanaProvider>
  );
}
```

**Verification:**
- Without wallet: navigating to "/" should redirect to "/onboarding"
- With wallet: navigating to "/onboarding" should redirect to "/"
- All routes should work correctly

---

### Task 4.8.2: Create Hooks Index

**File:** `src/hooks/index.ts`

**Code:**
```typescript
export { useBalance, useSOLBalance } from './useBalance';
export { useTransaction } from './useTransaction';
export { useSwap } from './useSwap';
```

**Verification:**
```typescript
// Should be able to import:
import { useBalance, useTransaction, useSwap } from '@/hooks';
```

---

## Code Review Checkpoint: MVP 1.1.0 Complete

### Verification Checklist

Run the following to verify MVP 1.1.0:

```bash
cd /Users/lucasbertol/zenwallet

# 1. Install any missing dependencies
npm install @solana/spl-token

# 2. Build project (no TypeScript errors)
npm run build

# 3. Start dev server
npm run dev
```

### Manual Testing Checklist

| Feature | Test | Expected |
|---------|------|----------|
| **Auth Guard** | Visit "/" without wallet | Redirect to /onboarding |
| **Home Page** | Create/import wallet, visit "/" | Show balance card + tokens |
| **Balance** | View balances | SOL balance shown (tokens if on mainnet) |
| **Send Modal** | Click Send, enter address/amount | Modal opens, validation works |
| **Receive Modal** | Click Receive | QR code + copy address works |
| **Swap Page** | Enter amount, select tokens | Quote fetched, swap button enabled |
| **Assets Page** | Navigate to /assets | Full token list shown |
| **Achievements** | Navigate to /achievements | Achievement grid shown |
| **Settings** | Navigate to /settings | Wallet info + delete option |
| **Gamification** | Complete actions | XP notifications appear |

---

## Files Summary

### New Files (13)
1. `src/types/token.ts`
2. `src/constants/tokens.ts`
3. `src/lib/solana/tokens.ts`
4. `src/lib/solana/transactions.ts`
5. `src/lib/jupiter/client.ts`
6. `src/hooks/useBalance.ts`
7. `src/hooks/useTransaction.ts`
8. `src/hooks/useSwap.ts`
9. `src/hooks/index.ts`
10. `src/components/wallet/BalanceCard.tsx`
11. `src/components/wallet/TokenList.tsx`
12. `src/components/wallet/SendModal.tsx`
13. `src/components/wallet/ReceiveModal.tsx`
14. `src/components/wallet/SwapInterface.tsx`
15. `src/components/wallet/index.ts`

### Updated Files (6)
1. `src/App.tsx` - Auth guards + new pages
2. `src/pages/Home.tsx` - Full implementation
3. `src/pages/Assets.tsx` - Full implementation
4. `src/pages/Swap.tsx` - Full implementation
5. `src/pages/Achievements.tsx` - Full implementation
6. `src/pages/Settings.tsx` - Enhanced

---

## Execution Modes

After this plan is ready, choose execution mode:

| Mode | Description |
|------|-------------|
| **Execute Now** | Start implementation immediately |
| **Parallel Session** | Open new session for batch execution |
| **Save for Later** | Keep plan for manual review |

---

## Recommended Agents

| Task Type | Agent |
|-----------|-------|
| Frontend components | `frontend-engineer` |
| Hooks/stores | `frontend-bff-engineer-typescript` |
| Testing | `qa-analyst` |
| Fallback | `general-purpose` |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-12-26 | Initial MVP 1.1.0 plan |
